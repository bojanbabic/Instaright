<!--
  Copyright (c) 2009 Google Inc.

  You are free to copy and use this sample.
  License can be found here: http://code.google.com/apis/ajaxsearch/faq/#license
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<title>Experimenting with Google App Engine - Bret Taylor's blog</title>
<link rel="stylesheet" href="/static/blog.css" type="text/css"/>
<link rel="alternate" href="#" type="application/atom+xml" title="Bret Taylor's blog"/>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>
      Google Visualization API Sample
    </title>
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.load('visualization', '1', {packages: ['imagechart']});
    </script>
    <script type="text/javascript">
      function drawVisualization(type, statsForDate) {
        var options = {};
		if (!statsForDate){
			today = new Date();
			day = today.getDate();
			day--;
			day = day + "";
			if ( day.length == 1 ) {
				day = "0" + day;
			}
			month = today.getMonth();
			month++;
			month = month + "";
			if (month.length == 1 ){
				month = "0" + month;
			}
			year = today.getFullYear();
			statsForDate = year+'-'+month+'-'+day; 
		}
		if (type == 1){
			typeString = 'weeklyfeed';
		}
		else {
			typeString = 'dailyfeed';
		} 
		//typeString = 'weeklyfeed'
		staticurl = 'http://instaright.appspot.com/visual?type='
		dataurl = staticurl + typeString + '&date=' + statsForDate
		alert(dataurl);
      
        // 'bhg' is a horizontal grouped bar chart in the Google Chart API.
        // The grouping is irrelevant here since there is only one numeric column.
        options.cht = 'bhg'; 
      
        // Draw labels in pink.
        var color = 'ff3399';
      
        // Google Chart API needs to know which column to draw the labels on.
        // Here we have one labels column and one data column.
        // The Chart API doesn't see the label column.  From its point of view,
        // the data column is column 0.
        var index = 0;
      
        // -1 tells Google Chart API to draw a label on all bars.
        var allbars = -1;
      
        // 10 pixels font size for the labels.
        var fontSize = 10;
       
        // Priority is not so important here, but Google Chart API requires it.
        var priority = 0;
      
        options.chm = [color, index, allbars, fontSize, priority].join(',');
        
         //new google.visualization.Query('http://5.latest.instaright.appspot.com/visual?type=weeklyfeed&date=2009-12-22').send(
         new google.visualization.Query(dataurl).send(
           function(response){
             
             new google.visualization.ImageChart(document.getElementById('visualization')).draw(response.getDataTable(), options);  
           });
       
      }
      

      google.setOnLoadCallback(drawVisualization);
    </script>
</head>

<body>
<div id="body">
<div id="header">
</div>
<div id="content">

	<div id="sidebar">
		<div class="section">
			<div class="headline"><img src="/static/images/find-me-on-the-web.png" style="width:139px" alt="Stats in last 5 days"/></div>
			<table class="icons">
				{% for d in dailyStats %}
				<tr>
				<script type="text/javascript">
					var targetDate = "{{ d }}";
				</script>
				<input type="button" onclick="drawVisualization(0, targetDate );" value="{{ d }}"/>
				</tr>
				{% endfor %}
			</table>
			<div class="headline"><img src="/static/images/find-me-on-the-web.png" style="width:139px" alt="Stats in last 5 weeks"/></div>
			<table class="icons">
				{% for d in weeklyStats %}
				<script type="text/javascript">
					var targetDate = "{{ d }}";
				</script>
				<tr>
				<input type="button" onclick="drawVisualization(1, targetDate );" value="{{ d }}"/>
				</tr>
				{%endfor%}
			</table>
		</div>
	</div>

	<div id="entries">
		<div class="entry">
			<h1><a href="#"></a></h1>
			<div class="body">
    				<div id="visualization" style="width: 300px; height: 300px;"></div>
			
			</div>
		</div>
	</div>
</div>
<!-- closing body div -->
</div>

</body>
</html>

