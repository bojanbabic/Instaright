<!-- Google Website Optimizer Control Script -->
<!-- A/B testing 
<script>
        function utmx_section(){}function utmx(){}
        (function(){var k='2188815013',d=document,l=d.location,c=d.cookie;function f(n){
                        if(c){var i=c.indexOf(n+'=');if(i>-1){var j=c.indexOf(';',i);return c.substring(i+n.
                                        length+1,j<0?c.length:j)}}}var x=f('__utmx'),xx=f('__utmxx'),h=l.hash;
                d.write('<sc'+'ript src="'+
                'http'+(l.protocol=='https:'?'s://ssl':'://www')+'.google-analytics.com'
                +'/siteopt.js?v=1&utmxkey='+k+'&utmx='+(x?x:'')+'&utmxx='+(xx?xx:'')+'&utmxtime='
                +new Date().valueOf()+(h?'&utmxhash='+escape(h.substr(1)):'')+
                '" type="text/javascript" charset="utf-8"></sc'+'ript>')})();
</script><script>utmx("url",'A/B');</script>
--> 
<!-- End of Google Website Optimizer Control Script -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
        <head>
                <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
                <meta name="description" content="Instarigt Instapaper Firefox addon, realtime addon streaming, xmpp instapaper article updates, article recommendation" />
                <meta name="keywords" content="Instaright, Instapaper firefox, Instapaper for firefox, instapaper import delicious, import delicious bookmarks, instapaper delicious, delicious importer, export delicious bookmarks to instapaper, instapaper addon for firefox, instapaper add-on firefox, instapaper add-on, social bookmark, read it later" />
                <link rel="stylesheet" type="text/css" href="css/style.css" />
                <script src="http://www.google.com/jsapi?key=AIzaSyDu78p4P0qEe3CTU4GssVBz_crZemld_eg" type="text/javascript" charset="utf-8"></script>
                <!--script src='/_ah/channel/jsapi'></script-->
                <script src='static/javascript/channel.js'></script>
                <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
                <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
                <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
                <title>Instaright Realtime Stream</title>

                <!-- google analytics -->
                <script type="text/javascript">

                        var _gaq = _gaq || [];
                        _gaq.push(['_setAccount', 'UA-9005862-5']);
                        _gaq.push(['_trackPageview']);

                        (function() {
                         var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                         ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                         var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                         })();
                 </script>
                 <!-- Google Website Optimizer Tracking Script -->
                 <!-- visibli bar -->
                 <!-- end visibli bar -->
<!-- 
<script type="text/javascript" src="http://platform.visibli.com/js/jquery/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="http://platform.visibli.com/js/adanywhere.js?apikey=05e8883aeea8d420&v=1&sharedomain=instaright.appspot.com&rootdomain=visibli.com"></script>
-->
                 <script type="text/javascript" src="http://platform.visibli.com/js/jquery/jquery-1.3.2.min.js"></script>
                 <script type="text/javascript" src="http://platform.visibli.com/js/adanywhere.js?apikey=a947824b599193b3&amp;v=1&amp;sharedomain=links.visibli.com&amp;rootdomain=instaright.appspot.com"></script>
         </head>
         <body>
                 <script type="text/javascript" charset="utf-8">
                         if( !window.XMLHttpRequest ) XMLHttpRequest = function()
{
        try{ return new ActiveXObject("Msxml2.XMLHTTP.6.0") }catch(e){}
        try{ return new ActiveXObject("Msxml2.XMLHTTP.3.0") }catch(e){}
        try{ return new ActiveXObject("Msxml2.XMLHTTP") }catch(e){}
        try{ return new ActiveXObject("Microsoft.XMLHTTP") }catch(e){}
        throw new Error("Could not find an XMLHttpRequest alternative.")
};
var channel_id= '{{ channel_id }}';
var channel = new goog.appengine.Channel(channel_id);
var socket = channel.open();
var maxElementsInStream=4;
var maxHotLinks = 3;
socket.onopen = function(){
        //alert('connected');
}
socket.onmessage = function(evt){
        try{
                feed_json_update = JSON.parse(evt.data);
                updateDisplayEntry(feed_json_update, stream);
        } catch(e){
                //alert('eee:'+e);
        } 
};


$(document).ready(function(){
		$("#invite_jid").bind('keypress', function(e){
			if (e.keyCode == 13){
			check_and_send_jid();
			}
			});
		$("#invite_jid").focus(function(){
			$(this).val("");
			});
		$.get('/feed?format=json', {}, updateDisplayEntry)
		$("#jid_result").hide();
		$("#invite_jid").focus();
                });

// Create variables to display subscription options using HTML DIVs

var stream = document.getElementById('stream');

// Initialize the API.
var feed;
function check_and_send_jid(){
        jid= $("#invite_jid").val();     
        if (jid.indexOf("@") == -1 || jid.indexOf(" ") != -1){
                $("#jid_result").html("<b>not valid jabber address</b>");
                $("#jid_result").show();
        }
        else{
                send_invite();
                $("#jid_result").html("<b>Message sent. you will receive IM from instaright@appspot.com</b>");
                $("#jid_result").show();
        }
        $("#jid_result").delay(2000).fadeOut('slow');
        $("#invite_jid").val('');     
}

function updateDisplayEntry(response, div) {
        try{
                div = document.getElementById('stream');
                for (i = response.length - 1; i >= 0; i--) {
                        e = response[i]['u'];
                        domain = e['d'];
                        try{
                                title=e['t'];
                        }catch(e){
                                title="Instaright article from domain "+domain;
                        }
                        if (title == null || title == 'None' || title == 'null' || title.length == 0){
                                title="Instaright article from domain "+domain;
                        } else {
                                try{
                                if ((title.charCodeAt(0) > 256 || title.charCodeAt(title.length/2) > 256)   && title.length >= 40){
                                        title = title.substr(0,37) + ' ...';
                                }
                                else if (title.length >= 70){
                                        title = title.substr(0,67) + ' ...';
                                }
                                } catch(e){
                                }
                        }
                        link = e['l'];
                        dateUpdated = new Date(e['u']);
                        id = e['id'];
			a = e['a'];
                        original_url = e['ol'];

                        container = document.createElement('div');
                        containerAvatar = document.createElement('div');


                        avatarElement = document.createElement('img');
                        avatarElement.setAttribute('src', a);
                        avatarElement.setAttribute('class', 'avatar');

                        containerAvatar.appendChild(avatarElement);
                        container.setAttribute('class', 'streamcontent');
                        container.setAttribute('id', id);

                        titleElement = document.createElement('a');
                        titleElement.innerHTML = title;
                        if (original_url === undefined){
                                titleElement.href = link;
                        } else{
                                // visibli link
                                titleElement.href ='http://links.visibli.com/a947824b599193b3/?web=058421&dst='+original_url;
                        }
                        titleElement.target="_new"
                        titleParagraph = document.createElement('p');
                        titleParagraph.appendChild(titleElement);

                        domainElement = document.createElement('a');
                        domainElement.innerHTML = domain;
                        domainElement.href = 'http://links.visibli.com/a947824b599193b3/?web=058421&dst='+'http://'+domain;
                        domainElement.target="_new"

                        container.appendChild(containerAvatar);
                        container.appendChild(titleParagraph);
                        container.appendChild(document.createElement('br'));
                        container.appendChild(domainElement);
                        container.appendChild(document.createElement('br'));

                        contentParagraph = document.createElement('p');
                        contentParagraph.innerHTML = dateUpdated;

                        domainParagraph = document.createElement('p');
                        domainParagraph.innerHTML = domainElement;

                        container.appendChild(contentParagraph);
                       
                        div.insertBefore(container, div.firstChild);
                        $("#"+id).hide();
                        $("#"+id).show('blind');
                        sElements = $("#stream").children();
                        if (sElements.length > maxElementsInStream ){
                                lastElement = sElements.get(-1); 
                                last_id = lastElement.getAttribute('id');
                                //alert('id:'+ id);
                                $("#"+last_id).hide();
                                div.removeChild(lastElement)
                        }
                }

        }catch(e){
                alert("while adding new element :" +e);
        }
}
function send_invite(){
        try{
                $.post("/send_invite", $("#invite_jid").val());
        } catch(e){
                alert('e:'+e);
        }

}
</script>


<div id="header" class="container_24">
        <div style="text-align: right;">
<!--iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.facebook.com%2Fpages%2FInstaright-Firefox-addon-for-Instapaper%2F105396136190038&amp;layout=button_count&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:450px; height:21px;" allowTransparency="true"></iframe-->
                <ul> 
                        {% if user %}
                        <li>Hi {{ user }}</li>
                        {% else %}
                        <li><a id="btn_login" href="{{ login_url }}" title="Login">introduce yourself</a></li>
                        {% endif %}
                        <li>
                        </li>

                </ul>
        </div>
</div>
<div class="wrapper"> 
        <div id="content" class="container_24"> 
                <div id="left_col" class="grid_18"> 
                        <div class="left_box_top"> 
                                <h2 class="round_title"> 
                                        <span>Instaright Stream</span> 
                                </h2> 
                        </div> 
                        <div class="left_box_mid">
                                <style> 
                                        #streammap{
                                                border:8px solid #ffffff;
                                                height:230px;
                                                margin:0px 0px 10px 0px;
                                                width:660px;
                                        }
                                        .scan, .streamcontent {
                                                -moz-border-radius:15px;
                                                border:1px solid #ADA699;
                                                clear:both;
                                                display:block;
                                                margin:10px 0px 10px 0px;
                                                padding:10px;
                                                text-decoration:none;
                                        }
                                </style>
                                <div id="stream"></div>
                        </div>
                                <!--style>
                                        .hot_story_link {
                                                background:#bbbb22; 
                                        }
                                 .hot_story_link, .hot_story {
                                 -moz-border-radius:15px;
                                 border:1px solid #ADA699;
                                 clear:both;
                                 display:block;
                                 margin:10px 0px 10px 0px;
                                 padding:10px;
                                 text-decoration:none;
                                 } 
                                </style>
                        {% for l in hotlinks %}
                        <div id="hot_story"><p class="hot_story_link"><a href="{{ l.url }}">{{ l.title }}</a></p>
                        <ul class="hot_story">
                                {% if l.tweets %}
                                <li> 
                                        <span><img src="/static/images/twitter_small.png"/>{{ l.tweets }}&nbsp;&nbsp;&nbsp;</span>
                                </li>
                                {% endif %}
                                {% if l.facebook_like %}
                                <li>
                                        <span><img src="/static/images/facebook_small.png"/>{{ l.facebook_like }}&nbsp;&nbsp;&nbsp;</span>
                                </li>
                                {% endif %}
                                {% if l.redditups %}
                                <li>
                                        <span><img src="/static/images/reddit_small.png"/>{{ l.redditups }}&nbsp;&nbsp;&nbsp;</span>
                                </li>
                                {% endif %}
                                <li>
                                {% if l.delicious_count %}
                                        <span><img src="/static/images/delicious_small.png"/>{{ l.delicious_count }}&nbsp;&nbsp;&nbsp;</span>
                                </li>
                                {% endif %}
                                {% if l.instapaper_count %}
                                <li>
                                        <span><img src="/static/images/instapaper_small.png"/>{{ l.instapaper_count }}&nbsp;&nbsp;&nbsp;</span>
                                </li>
                                {% endif %}
                                {% if l.diggs %}
                                <li>
                                        <span><img src="/static/images/digg_small.png"/><span>{{ l.diggs }}&nbsp;&nbsp;&nbsp;</span>
                                </li>
                                {% endif %}
                        </ul>
                        </div>
                        {% endfor %}
                        </div--> 
                        <!--div class="left_box_mid_close"></div-->
                        <div class="left_box_bot"> 
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                         var disqus_shortname = 'instaright'; // required: replace example with your forum shortname

                         // The following are highly recommended additional parameters. Remove the slashes in front to use.
                         var disqus_identifier = 'agppbnN0YXJpZ2h0chULEgxTZXNzaW9uTW9kZWwY_7fmAgw';
                         var disqus_url = 'http://instaright.appspot.com';

                         /* * * DON'T EDIT BELOW THIS LINE * * */
                         (function() {
                                 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                                 dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                                 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                         })();
                </script>
                <noscript>Please enable JavaScript to view the comments</noscript>
                        </div>
                </div>
                <div id="right_col" class="grid_6">
                        <div id="right_box_top">
                                <p style="text-align: center;">Instaright Firefox addon</p>
                                <p style="text-align: center;"><a title="Instapaper firefox addon" href="http://instaright.appspot.com/article/agppbnN0YXJpZ2h0chULEgxTZXNzaW9uTW9kZWwY_7fmAgw"><img src="static/images/install_now.png" style="width:220px; height: 60px;" alt="Instapaper firefox addon"/></a></p>
                                <p class="social_media">Realtime tracking</p>
                                <div class="text-align: center; width: 270px;">
                                        Track domains on Instaright in realtime<br>
                                        on your favorite client.
                                        <p id="jabbers">
                                        <img src="/static/images/messenger.png"/><img src="/static/images/gtalk.png"/><img src="/static/images/aim.png"/></p>
                                        </div><p></p><div>
                                        <p>To get started enter your jabber id and wait for invite from our bot and <span style="color:#0066CC;">press Enter</span></p>

                                        <input type="text" id="invite_jid" value="Enter your jabber id" />
                                        <div id="jid_result" style="text-align: center; "></div>
                                        <p></p>
                                </div>
                        </div>
                        <div id="right_box_mid">
                                <ul>
                                        <li class="social_media"><img align="left" src="/static/images/twitter.png" title="Instapaper tools on twitter"/><a href="http://twitter.com/instaright">Twitter</a></li>
                                        <li class="social_media"><img align="left" src="/static/images/facebook.png" title="Instapaper tools on facebook"/><a href="http://www.facebook.com/pages/Instaright-Firefox-addon-for-Instapapaer/105396136190038">Facebook Page</a></li>
                                        <li class="social_media"><img align="left" src="/static/images/blog.png" title="Instapaper tools blog"/><a href="http://instaright.tumblr.com/">Blog</a></li>
                                        <li class="social_media"><img align="left" src="/static/images/arrow_right.png"/><a href="/tools/delicious" title="Import Delicious Bookmarks to Instapaper">Delicious Import to Instapaper</a></li>
                                </ul>
                        </div>
                        <div id="right_box_bot">
                                <div>

                                </div>

                        </div>
                </div>
        <div class="clear"></div> 
        <div class="push"></div> 
</div>
<div class="clearfix"></div> 
</div>

<div class="footer-container">
        <div style="position: relative; text-align: center; color: rgb(0, 0, 204); font-size: small;">
                <p><a href="mailto:gbabun@gmail.com" title="Contact Instaright developer">contact</a> | <a href="http://twitter.com/instaright" title="instaright on twitter">twitter</a> | <a href="http://instaright.tumblr.com" title="instaright blog">blog</a></p>
        </div>
</div>
<!-- GETSATISFACTION -->
<script type="text/javascript" charset="utf-8">
        var is_ssl = ("https:" == document.location.protocol);
        var asset_host = is_ssl ? "https://s3.amazonaws.com/getsatisfaction.com/" : "http://s3.amazonaws.com/getsatisfaction.com/";
        document.write(unescape("%3Cscript src='" + asset_host + "javascripts/feedback-v2.js' type='text/javascript'%3E%3C/script%3E"));
        </script>

        <script type="text/javascript" charset="utf-8">
                var feedback_widget_options = {};

feedback_widget_options.display = "overlay";  
feedback_widget_options.company = "instaright";
feedback_widget_options.placement = "left";
feedback_widget_options.color = "#222";
feedback_widget_options.style = "idea";
var feedback_widget = new GSFN.feedback_widget(feedback_widget_options);
</script>
<!-- End GETSATISFACTION -->
<!-- Google Website Optimizer Tracking Script -->
<script type="text/javascript">
        if(typeof(_gat)!='object')document.write('<sc'+'ript src="http'+
                        (document.location.protocol=='https:'?'s://ssl':'://www')+
                        '.google-analytics.com/ga.js"></sc'+'ript>')</script>
                <script type="text/javascript">
                        try {
                                var gwoTracker=_gat._getTracker("UA-9005862-6");
                                gwoTracker._trackPageview("/2188815013/test");
                                }catch(err){}
                </script>
<!-- End of Google Website Optimizer Tracking Script -->
<!-- Begin Survey.io code for . -->
                <script src="http://cdn.survey.io/embed/1.0/survey.js" type="text/javascript"></script>
                <script type="text/javascript" charset="utf-8">
                        Surveyio.init({
survey_id: "396ea",
token: "a787ed2e15426c0d99b9b9ce5d130a20feb62c91",
banner: {
x: "right",
y: "bottom",
color: "blue"
}
});
</script>
<!-- /End Survey.io code -->
<!-- apture bar -->
<script id="aptureScript">
(function (){var a=document.createElement("script");a.defer="true";a.src="http://www.apture.com/js/apture.js?siteToken=B6cWD6D";document.getElementsByTagName("head")[0].appendChild(a);})();
</script>
<!-- end apture bar -->

        </body>
</html>
